{% extends '_base.html' %}

{% block title %}Edit{% endblock %}

{% block content %}
<a href="{{ url_for('home') }}"><strong>Back</strong></a>

<div class="row">
    <input class="col s6" v-model='name' placeholder="Recipe name"/>
</div>

<p><strong>Ingredients</strong></p>
<ul class="collection">
    <li class="collection-item" v-for='ingredient in ingredients'>
        <div class="row">
            <div class="col s1 input-field">
                <input v-model='ingredient.amount' placeholder="1" />
            </div>
            <div class="col s3 input-field">
                <input v-model='ingredient.unit' placeholder="cup" />
            </div>
            <div class="col s3 input-field">
                <input v-model='ingredient.name' placeholder="flour" />
            </div>
        </div>
    </li>
</ul>
<a class="waves-effect waves-light btn" @click='addIngredient'>Add Ingredient</a>

<p><strong>Steps</strong></p>
<ul class="collection">
    <li v-for='step in steps'>
        <div class="collection-item">
            <textarea class="materialize-textarea" v-model='step.description'></textarea>
        </div>
    </li>
</ul>
<a class="waves-effect waves-light btn" @click='addStep'>Add Step</a>
<hr>
<a class="waves-effect waves-light btn" @click='saveRecipe'>Save Recipe</a>
{% endblock %}

{% block pre_app_script %}
    var ingredient_template = {
        measure: null,
        unit: '',
        name: ''
    }
    var step_template = {
        description: ''
    }
{% endblock %}

{% block app_data %}
    name: '',
    ingredients: [
        Object.assign({}, ingredient_template)
    ],
    steps: [
        Object.assign({}, step_template)
    ]
{% endblock %}

{% block app_methods %}
    addIngredient: function() {
        this.ingredients.push(Object.assign({}, ingredient_template))
    },
    addStep: function() {
        this.steps.push(Object.assign({}, step_template))
    },
    saveRecipe: function() {
        axios.post(
            "{{ url_for("save_recipe") }}",
            {
                name: this.name,
                ingredients: this.ingredients,
                steps: this.steps.map(step => step.description)
            }
        )
    }
{% endblock %}
